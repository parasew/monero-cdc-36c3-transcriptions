# Francisco 'ArticMine' Cabañas

_**Critical Decentralisation Cluster 36c3 - Monero’s Adaptive Blockweight Approach to Scaling**_

[youtu.be/btauHXDIM8M](https://youtu.be/btauHXDIM8M)

_**Abstract**_

Monero has a unique among the major crypto currencies approach to scaling, that relies on a penalty driven adaptive blockweight (blocksize) and a minimum or tail block reward. This is fundamentally different from the fixed blockweight and falling bock rewards that are prevalent in Bitcoin and Bitcoin clones. We will provide an overview of Monero’s adaptive blockweight, fee market and how blockweight differs from blocksize together with the dual median changes and transaction changes that were introduced in the 2019 spring and fall network updates. We will compare adaptive vs fixed blockweights, and the impact of minimum block rewards (Monero) vs falling block rewards (Bitcoin and Bitcoin clones) on long term network security.

_**Transcription**_

_Diego:_ Ok, all right, we're ready to go, let me go ahead and introduce Francisco Cabanas, he is a core team member goes by ArticMine, not ArcticMine, like it's actually spelled, but the ArticMine, I mean maybe he'll talk about that, maybe not, maybe we're more interested in his thing on the adaptive block weight. So let's give him a great big hand, thank you so much for coming and tell us all about this whole scaling thing.

_Francisco:_ Ok. So what I'm going to talk about is an aspect of Monero that is generally not discussed very commonly, but it's quite unique to Monero and in fact makes Monero one of the few may be the only viable proof-of-work cryptocurrency.

So there's an overview out of the talk today, we're looking at block weight versus block size, rational miners and users, fee and block weight, return to the rational miner, go back to that question. And then we look at that one of the scenarios as to what happens when the block reward goes to zero, the elephant in the room for a lot of very major coins, and what the implications are for both Monero and also for Bitcoin, Bitcoin like small block weights and also the Satoshi fee market.

So first of all maybe is block weight versus block size in Monero. Block weight was introduced in Monero at the same time as Bulletproofs, and the main reason is because verification time scales as the log while, sorry it scales, its linear, well the proof size scales as base2 log, and so what we wanted to do is to ensure that your pricing verification time properly to prevent certain types of attacks. So for 2 outputs transaction we define the transaction weight equals to the transaction size. For more than 2 outputs with 80% of the savings, we clawback and then we gross up the weight, and so the weight is the block size plus these clawbacks. And the idea basically is to ensure that you are pricing correctly. Most people confuse them and it's easy to do that, but that's essentially what that is about. Everything I talk about will be block weights as far as the penalty functions are concerned etc, so that's where we go from there.

So what is a rational miner. Well here we have something is very simple — we have a rational miners and rational users, they're interacting in what is known as a free market and they're acting in their best enlightened self interest. They are not altruistic, they are not malicious. The miner wants the maximum return. They usually want to pay the lowest fee and the extra in the free market.

So the problem is you have a finite number of transactions in the transaction pool. You a miner, you have a certain distribution of fees and weights, and hence you gotta figure out which ones you got in the block. You want to maximize your cost, sorry, maximize your return, you want to minimize the cost to the user. The full problem is actually a discrete optimization problem that can be solved exactly, it's a big huge matrices. But basically what it is you gotta find the optimal transaction mix.

So if we look at this the actual review of how block and weight scaling works in Monero, and this is what makes Monero fundamentally different from Bitcoin. So any ideas that you have from Bitcoin or from Bitcoin Cash, from Litecoin about fees and block sizes, you gotta throw them all out, because what drives Monero fees and it's adaptive block size limit is the penalty. And it's the penalty that you pay you agree to a miner block that is higher in block weight than the median. So if you increase the block size you pay a penalty and you lose a portion of your block reward, and that's the key thing. So a key of… numbers of course the MB is the transaction block weight, then you have the MS as a short term median which is your median, ML is the long term median, and that's a recursive calculation, and MN is the minimum of the two medians, sorry MN is the minimum of the total median of the ML which is the long term median, ok.

I should point out these slides are available for download from the site, so you can actually get them if you miss something. So base is your base reward and the reward paid to the miner basically is based on this formula, penalty formula. If you mine a block which is twice the size as a median you got nothing, I mean in block, in fees, sorry in block reward. So your fees have to compensate you for that. And the main change in 2019 was the introduction of the long term median. And then the idea behind the long term median was to cap the short term median of 50 times the long term median, and it's an anti spam measure while at the same time allowing for long term scaling, and also allowing for abash to accommodate a seasonal in increase in transaction rates.

So ok, so we can define, make some simplifying definitions, B can be thought as the ratio of the MB and MN and it can be thought as the percentage increase in the block weight when your mine an oversized block. So the penalty then can be reduced to the base reward times B2, always have the base reward in here and B can be thought as percentage increase in the block weight and that's the penalty you pay. So if you mined a block let's say 10% bigger your penalty will be 1% of your block reward regardless of the initial size of the block, of the median.

So then the next consideration that we get is what happens when we add a penalty attracting transaction, and they do a bunch of formulas, and you essentially get that the initial transaction as this formula here is based on 2BBT, BT is transaction block weight, plus BT2, and B is how much into the penalty you already in. So that formula determines the fee that the miner will require from that transaction to include it.

So that then defines our fees. And so you have two fees basically, the median for the calculation that we used to fees is the minimum of the long and short term medians. And if you have your MF we have 300 thousand bytes. Then an A 2 input and 2 output transaction. What you have is you use a reference of three thousand bytes and that's just the typical transaction size plus a margin for safety. So that's defined by this minimum penalty fee of block size, sorry, of block weight of 300 thousand bytes and the typical transaction size. That's what determines your normal fee in Monero. And the key thing to understand is that the fee per byte is proportional to the ratio. So if for example I had happen in 2018, if you lower the transaction size by a factor of five, your fees actually go down by a factor of 25. And that's why we saw such a dramatic drop in fees when we went into Bulletproofs, because that's exactly what happened the fee per byte drops by five and then your size of the transaction also drops by five, so the overall fee drops by a factor of 25.

Then the next fees are set up basically based on the normal fee, and so in summary this is what you'll get — you'll get a low fee is 0.002R. Now remember every single fee’s calculations are basis in there, are bases your block reward, and this is very important to realize — are base is always part of these calculations. And the other calculation coming is that median size of the block size. So if you make MF ten times bigger, the fees per byte go down by a factor of ten, the transaction size stays the same, the block size is ten times bigger, your fees go down by five or ten.

So now you see a lot of high fees arbitrary, they're based actually of the normal fee, and so that wide spread, the highest fee is again the highest that you can get to match up the penalty to the extreme, that defines that fee. So fees and Monero are set by the penalty, the interaction of the penalty with a minimum penalty fee block size, that's what determines fees. And they are driven by a free market.

So all of the impacts of this change. Well in 2019 we added a long term median, it basically increases across to a spammer by a factor of 50 times, it's a 10, it's a 50 thousand block median of no penalty. So essentially what it does it prevents a big bloating attacks, while at the same time maintaining flexibility in the system, that it will allow you to deal with say a Christmas season in shopping, where if you look at some of our major competitors, such as Visa, their numbers are roughly 20 times the average rate of transactions on a day like December 23rd. So you have to have take into account if you're gonna play the transaction game. In retail you have to have the ability to scale on demand to meet seasonal demand, and I'm not sure of any other coin that it's actually gone to the trouble at building this in. So that you have a system that allows you to run retail transactions.

So we'll go back to a rational miner. They basically users in Monero. They're basically ran transaction in order of profitability. And then you get… sorry, not too fast. And basically again the lowest fee is paid as is formula, the lowest we pay transaction in the block is the one that is at the highest penalty level. So the miner makes a profit on the penalty. The fee still remind how far you wish to push the penalty in order to get there. The miners to make a profit and this is a free market running the entire thing.

One of the things are critical in this to understand is that the total fees per block are proportional to the block reward. And I want to emphasize this — the amount of fees that a miner gets per block is proportional to the block reward. This is one thing you get out of this talk, this is very important.

Because what happens when it goes to zero? So do the fees. It's that simple. The miners can try to say: well we're gonna impose a minimal fee and protocol — it doesn't work. So now your Monero avoids this through this approach the same we have a tail emission. That's why the tail emission is absolutely critical in Monero. Without it, it will not work. And the best example is Bytecoin which have the same formulas Monero does. Well the same before the launch of minerd work were added in. And it has the problem that they had to abandon it and go to a minor setting the block size effectively to control the fee. So you're back again to the Bitcoin problem. You have to restrict the block size in order to get the fees to compensate the miner or to try to compensate the miners. And the scenario for Bytecoin is miner cartel and tragedy of the commons.

Well take a brief look at Bitcoin here. My opinion the fee market that was envisioned in Bitcoin — there is no, I have not seen any academic argument. That says this is how suppose to work, what the game theory is, what the mathematics of. There was a common mean in the Satoshi’s paper. And that's it. That everybody is basically citing authority on. But that's all we have.

Now we take a look at some of implications. Bitcoin failed. Why? Because they've had to keep the fees and or close to fees to go up restrict the block size, and that killed the transaction as a transaction of currency. So basically all to have a success, you can have a stiffer penalty. Then what you have in Monero at least it have a chance, because we're turning in Monero it goes to zero. So basically you have something stricter. And the approach there have in Bitcoin community is this one megabyte block weight limit and they're under their block weight which effectively is the most prudent approach in my opinion. But it will not allow for transactional currency.

So we get the forks. Bitcoin say: come on let’s make these blocks, but they still get lesson transaction fees. Bitcoin Cash — thirty two megabyte blocks which by the way if you compensate for nuisance law of bandwidth, that's actually smaller today then when the one megabyte block was introduced in 2010. And I get a sense of déjà-vu when I look at Bitcoin Cash. They're talking great things but in reality where is the code, where is the formula? Has it mean looked at? Can it be attacked? I will suggest yes, if you only have fees which is the lowest day in the year, that you will have less transaction flow Christmas day. So guess what. You want to attack a fee-only coin you can't play Scrooge. And that's a theoretical attacks won't work right now. So it's perfectly fine to disclose it. But let's wait a decade or two and taking a serious look — if you don't do anything about it would become cash be attackable what Bitcoin is maybe attackable, and I will say there are maybe, let's say for the 200th anniversary of Charles Dickens Christmas go. Again when I get a few more questions than answers.

So here are my conclusions. This the tail emission of Monero is critical for the success of Monero. The Satoshi fee market is unproven and may not even work at all. Cryptocurrencies with maximum number of coins and falling rock rewards create more questions than real answers. And I think I'm just about on time.

_Diego:_ Thank you very much ArticMine. We don't have time for questions. He used all of his a lot of time, he should be available for questions offstage, if you would like to discuss these things with him. We are going to get prepared for our next talk which is in about 5 minutes. It's gonna be talking about NIM from Harry Helpin, Haplin — one of those two LP I didn't quite get 100% which one that was. So let's go ahead and we're gonna we're getting a slides up ready to go. While that happens again feel free to talk with ArticMine about the adaptive block weight of Monero once more. We've got the Foss Asia stuff going on back there. If you want to go and talk with them about what they're doing in their workshop. Other than that there's the entirety of c3 for you to enjoy, so I hope you guys are having a great time so far.
